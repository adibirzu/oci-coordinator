# MCP Server Configuration
# ========================
#
# This file defines the MCP servers available to the OCI AI Agent Coordinator.
# Users can modify this file to add, remove, or configure MCP servers.
#
# DISCLAIMER: The external MCP servers referenced here are personal projects
# created to demonstrate OCI AI integration capabilities. These are NOT
# official Oracle products and are not endorsed by Oracle Corporation.
#
# External MCP Server Repositories:
# - database-observatory: https://github.com/adibirzu/mcp-oci-database-observatory
# - oci-infrastructure (mcp-oci): https://github.com/adibirzu/mcp-oci
# - finopsai-mcp: https://github.com/adibirzu/finopsai-mcp
#
# Transport Types:
# - stdio: Spawns a subprocess and communicates via stdin/stdout
# - http: Sends JSON-RPC requests over HTTP POST
# - sse: Server-Sent Events for streaming responses
#
# Each server should specify:
# - transport: The transport type (stdio, http, sse)
# - command/args: For stdio transport, the command to run
# - url: For http/sse transport, the server URL
# - enabled: Whether this server is active
# - domains: Which capability domains this server provides

# Default MCP Servers
servers:
  # Unified OCI MCP Server (built-in) - Identity, Compute, Network, Cost, Security
  # This is the primary server - no external dependencies
  oci-unified:
    transport: stdio
    command: .venv/bin/python
    args:
      - "-m"
      - "src.mcp.server.main"
    working_dir: .
    env:
      OCI_CONFIG_FILE: "~/.oci/config"
      OCI_CLI_PROFILE: "DEFAULT"
      MCP_OTEL_SDK_DISABLED: "false"  # Enable OTEL for observability
    enabled: true
    domains:
      - identity
      - compute
      - network
      - cost
      - security
      - observability
      - database
      - dbmgmt
    description: "Unified OCI MCP Server - compartments, compute, network, cost, security, database"
    timeout_seconds: 120  # Increased for slow initialization

  # Database Observatory - Primary database operations server
  # Set DB_OBSERVATORY_PATH environment variable or replace path below
  database-observatory:
    transport: stdio
    command: node
    args:
      - "dist/index.js"
    working_dir: ${DB_OBSERVATORY_PATH:-/path/to/mcp-oci-database-observatory}
    env:
      OCI_CONFIG_FILE: "~/.oci/config"
      OCI_CLI_PROFILE: "DEFAULT"
      # Force stdio transport (override database-observatory's .env.local which may set HTTP)
      MCP_TRANSPORT: "stdio"
      # SQLcl configuration - unified wallet with all connections
      SQLCL_PATH: ${SQLCL_PATH:-/Applications/sqlcl/bin/sql}
      SQLCL_TNS_ADMIN: ${SQLCL_TNS_ADMIN:-~/oci_wallets_unified}
      SQLCL_DB_USERNAME: ${SQLCL_DB_USERNAME:-ADMIN}
      SQLCL_DB_CONNECTION: ${SQLCL_DB_CONNECTION:-th_high}
      SQLCL_FALLBACK_CONNECTION: ${SQLCL_FALLBACK_CONNECTION:-ATPAdi_high}
      # OCI APM / OpenTelemetry configuration - pass through from parent environment
      MCP_OTEL_SDK_DISABLED: "false"  # Enable OTEL for observability
      OTEL_SERVICE_NAME: "oci-database-observatory"
      OCI_APM_ENDPOINT: ${OCI_APM_ENDPOINT:-}
      OCI_APM_PRIVATE_DATA_KEY: ${OCI_APM_PRIVATE_DATA_KEY:-}
      OCI_APM_PUBLIC_DATA_KEY: ${OCI_APM_PUBLIC_DATA_KEY:-}
      OCI_APM_DATA_UPLOAD_ENDPOINT: ${OCI_APM_DATA_UPLOAD_ENDPOINT:-}
      OTEL_EXPORTER_OTLP_ENDPOINT: ${OTEL_EXPORTER_OTLP_ENDPOINT:-}
      OTEL_EXPORTER_OTLP_HEADERS: ${OTEL_EXPORTER_OTLP_HEADERS:-}
    enabled: true
    domains:
      - database
      - opsi
      - logan
      - observability
    description: "Oracle Database Observatory with SQLcl, OPSI, and Logan Analytics"
    timeout_seconds: 120  # Increased for slow initialization
    # Note: Requires DB_OBSERVATORY_PATH env var pointing to mcp-oci-database-observatory clone

  # OCI Infrastructure MCP Server - External mcp-oci (fallback)
  # Set OCI_INFRASTRUCTURE_PATH environment variable or replace path below
  oci-infrastructure:
    transport: stdio
    command: python
    args:
      - "-m"
      - "mcp_server_oci.server"
    working_dir: ${OCI_INFRASTRUCTURE_PATH:-/path/to/mcp-oci}
    env:
      OCI_CONFIG_FILE: "~/.oci/config"
      OCI_CLI_PROFILE: "DEFAULT"
      ALLOW_MUTATIONS: "false"  # Set to "true" to enable write operations
      MCP_SERVER_ID: "oci-infrastructure"
      MCP_OTEL_SDK_DISABLED: "false"  # Enable OTEL for observability
    enabled: false  # Disabled - requires clone of https://github.com/adibirzu/mcp-oci
    domains:
      - compute
      - network
      - security
      - cost
      - database
      - observability
    description: "OCI Infrastructure MCP server - compute, network, security, cost management"
    timeout_seconds: 60

  # OCI Security MCP Server - Comprehensive security services
  # Set OCI_SECURITY_PATH environment variable or replace path below
  oci-mcp-security:
    transport: stdio
    command: python
    args:
      - "-m"
      - "oci_mcp_security.server"
    working_dir: ${OCI_SECURITY_PATH:-/path/to/oci-mcp-security}
    env:
      OCI_CONFIG_FILE: "~/.oci/config"
      OCI_CLI_PROFILE: "DEFAULT"
      PYTHONPATH: "src"
      MCP_OTEL_SDK_DISABLED: "false"  # Enable OTEL for observability
    enabled: false  # Disabled - requires clone of oci-mcp-security repo
    domains:
      - security
      - cloudguard
      - vss
      - bastion
      - audit
      - kms
      - waf
      - datasafe
      - accessgov
      - zones
    description: "OCI Security MCP server - Cloud Guard, VSS, Bastion, Audit, KMS, WAF, Data Safe"
    timeout_seconds: 60

  # OPSI MCP Server - Operations Insights (HTTP)
  # opsi:
  #   transport: http
  #   url: http://localhost:8000/mcp
  #   enabled: false
  #   domains:
  #     - opsi
  #     - performance
  #   description: "OCI Operations Insights via HTTP"

  # Logan MCP Server - Logging Analytics (HTTP)
  # logan:
  #   transport: http
  #   url: http://localhost:8001/mcp
  #   enabled: false
  #   domains:
  #     - logan
  #     - logging
  #     - audit
  #   description: "OCI Logging Analytics via HTTP"

  # FinOps AI MCP Server - Multicloud cost management
  # Set FINOPSAI_PATH environment variable or replace path below
  finopsai:
    transport: stdio
    command: python
    args:
      - "-m"
      - "finopsai_mcp.server"
    working_dir: ${FINOPSAI_PATH:-/path/to/finopsai-mcp}
    env:
      OCI_CONFIG_FILE: "~/.oci/config"
      OCI_CLI_PROFILE: "DEFAULT"
      PYTHONPATH: "src"
      MCP_OTEL_SDK_DISABLED: "false"  # Enable OTEL for observability
    enabled: false  # Disabled - requires clone of https://github.com/adibirzu/finopsai-mcp
    domains:
      - cost
      - budget
      - finops
      - anomaly
      - forecasting
      - rightsizing
    description: "Multicloud FinOps with anomaly detection, rightsizing, FOCUS support (OCI, AWS, Azure, GCP)"
    timeout_seconds: 120

  # Security MCP Server
  # security:
  #   transport: http
  #   url: http://localhost:8004/mcp
  #   enabled: false
  #   domains:
  #     - security
  #     - cloudguard
  #     - compliance
  #   description: "Security and compliance operations"

# Server Groups - Group servers by use case
# Agents can request servers by group name
groups:
  database:
    - oci-unified  # Primary for dbmgmt operations (fleet health, etc.)
    - database-observatory  # External fallback for SQLcl, OPSI, Logan
  observability:
    - database-observatory
    - oci-unified
  infrastructure:
    - oci-unified  # Primary for compute, network, security, identity
    - oci-infrastructure  # Fallback
  identity:
    - oci-unified  # Compartments, tenancy, regions
  security:
    - oci-mcp-security  # Cloud Guard, VSS, Bastion, Audit, KMS
    - oci-unified  # IAM, basic security
    - oci-infrastructure
  cost:
    - finopsai  # Primary for multicloud cost/FinOps
    - oci-unified  # Fallback for OCI cost
    - oci-infrastructure
  finops:
    - finopsai  # Anomaly detection, rightsizing, forecasting
  all:
    - oci-unified
    - database-observatory
    - oci-infrastructure
    - oci-mcp-security
    - finopsai

# Default Settings
defaults:
  timeout_seconds: 120  # Increased for large compartments (25+ resources)
  retry_attempts: 3
  backoff_multiplier: 2
  # Tool-specific timeouts (in seconds)
  tool_timeouts:
    # Infrastructure
    oci_compute_list_instances: 180  # Large compartments can have many instances
    oci_network_list_vcns: 120
    # Cost
    oci_cost_get_summary: 180
    # Observability
    oci_observability_query_logs: 300  # Log queries can be slow
    # Security
    oci_security_cloudguard_list_problems: 180
    oci_security_list_cloud_guard_problems: 180
    # DB Management
    oci_dbmgmt_get_fleet_health: 120
    oci_dbmgmt_list_databases: 180  # Can scan many compartments
    oci_dbmgmt_get_awr_report: 180  # AWR reports take time to generate
    # Operations Insights (OPSI) - these APIs are slow
    # Note: OPSI APIs can be very slow (>60s) due to backend processing
    oci_opsi_list_database_insights: 180
    oci_opsi_get_database_insight: 120
    oci_opsi_get_addm_findings: 240  # Often slowest - aggregates across all DBs
    oci_opsi_get_addm_recommendations: 240
    oci_opsi_summarize_resource_stats: 180
    oci_opsi_summarize_sql_insights: 180
    oci_opsi_summarize_sql_statistics: 240  # Can be slow with many DBs
    oci_opsi_search_databases: 120
    oci_opsi_get_capacity_trend: 180
    oci_opsi_get_capacity_forecast: 180
    oci_opsi_sql_insights: 180
